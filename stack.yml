version: "3.8"
name: celluloid-test-stack

volumes:
  app_db_data:

services:
  postgres:
    image: postgres:13
    ports:
      - "5432:5432"
    volumes:
      - app_db_data:/var/lib/postgresql/data
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: root
      POSTGRES_DB: celluloid

  celluloid:
    depends_on:
      - postgres
    ports:
      - "8080:80"
    environment:
      DATABASE_URL: postgres://postgres:root@localhost:5432/celluloid
      COOKIE_SECRET: changethistosecretcookie
      COOKIE_DOMAIN: 127.0.0.1
      COOKIE_SECURE: false
      STORAGE_URL: http://localhost:9000
      STORAGE_BUCKET: celluloid
      STORAGE_ACCESS_KEY: root
      STORAGE_SECRET_KEY: StrongPass2022
    # image: celluloid-compact:latest
    build:
      context: .
      dockerfile: ./Dockerfile.compact

  minio:
    restart: unless-stopped
    image: minio/minio
    ports:
      - "9000:9000"
    environment:
      MINIO_ROOT_USER: root
      MINIO_ROOT_PASSWORD: StrongPass2022
    command: server /data

  redis:
    image: redis:6-alpine
    restart: unless-stopped
    ports:
      - "6379:6379"
